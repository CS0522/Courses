# 王占峰

网络演习：硬件网络组建+网络结构设计实现+系统服务的管理【协议】

# 网络

通过通信子网连接多个资源子网，以便于共享硬件【云盘】、软件【在线office】、数据【电影】

协议：通信双方互相认知。协议 = 语法【组成和位置】 +  语义【如何处理】+  时序【次序】

参考模型：ISO组织的OSI7层参考模型，   TCP/IP 4/5层模型

分层设计：优势【降低耦合性，只需关注核心业务即可】

​                    上层（N+1）使用下层（N）提供的服务，下层通过SAP（服务访问点）向上层提供服务。

OSI和TCP/IP关系：

OSI理论模型，追求大而全，教学理论研究

TCP/IP实用模型，由实践得出

![image-20220502194440590](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220502194440590.png)

# 主机接口层

## 方式

模拟信道：连续的，远距离传递易失真

数字信道：可以是不连续的，可以多次放大以便远距离传输

## 信道带宽

W = f2 - f1   =   最高频率  -  最低频率

速率会使用码元描述（变换的次数），单位是   波特  

奈奎斯特：无噪声信道     码元 率 =   2 *  带宽    =  2  *  3000HZ  =   6000bps

香农定理：考虑到噪声      码元率 = 9.97 * 带宽  =  9.97 * 3000HZ  =  30000bps

常见的介质：   1Gbps双绞线   ，    54Mbps的无线基准

## 信道延迟

信源到信宿所需要的时间，  等同于光速300m/微秒， 电缆中一般是  77%  ，200m/微秒。

电缆 500m时延大约  2.5微秒  ，卫星时延 270毫秒

## 介质

有线

​    电缆

​        UTP非屏蔽双绞线，STP屏蔽双绞线。屏蔽电磁信号干扰。   标号越高速率越快、距离越短，

​    光纤

​        多模光纤多角度性能低于单模

​        

无线

## 数据编码

为什么要编码： 处于抗噪声，定时等目的。

1    单极性码： +3V表示0，   0V表示1，    配合时钟信号进行定时，应用场合   TTY （Console口 9600bps）， 抗噪声能力弱。

2    极性码：   正表示1和负电压表示0  ，电平差比单极性码大，抗干扰强，连续的1和0不易处理

3    双极性码：  交替反转编码

4    归零码

5    双相码

6    不归零码

7    曼彻斯特码： 主要应用在以太网，  编码效率    50%

8    差分曼彻斯特码：环形网络，抗干扰和自定时

9    多电平编码

10    4B/5B：效率  80%   

## 差错控制【确保可靠性】

检错码：默认的方式是丢弃

​    奇偶检验码：确保整个数据比特流中所有的位 存在的偶数个1

![image-20220509182037027](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509182037027.png)

​    循环冗余校验：CRC，效率和应用较广

​        多项式校验串和原文进行位操作

​        常见CRC：  CRC-16【磁盘  】**![image-20220509184955079](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509184955079.png)**

​    CRC-32:   网络

纠错码：

​    海明码：利用冗余数据为检测和纠正，在数据的每个2^N位插入纠错码，隔N位校验N位，所有N上的1为偶数。

![image-20220509184514659](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509184514659.png)

## 数据链路层

主要体现在局域网和城域网中，主要的协议族  802.X，例如  802.3    802.15    802.11    802.16  

数据链路层 =    逻辑链路控制子层LLC  +  介质访问控制子层MAC

802协议架构：

![image-20220509190643510](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509190643510.png)

常见的有线局域网和无线局域网区别在MAC子层

LLC结构 ：  ![image-20220509191611526](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509191611526.png)

DSAP：目的地址，  SSAP：源地址   ，   pre ：前导码    s:起始符          fill：填充（避免碎片）

以802.3网络【以太网Ethernet】为例

为了标识每个网络接口设备，给设备设定了唯一的id， MAC地址【物理地址】

以太网中  DSAP和SSAP  都占用   6个字节【MAC地址是48位地址】

如何查看自己的mac地址  ：    ipconfig  /all

![image-20220509192239567](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509192239567.png)

![image-20220509193034027](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509193034027.png)

MAC地址以及链路层封装只在局域网范围生效，互联网通信过程中，ip地址可能不变，每经过一个网络（路由器）数据链路层会被重新封装【MAC地址发生改变】

## 以太网  802.3技术

![image-20220509195502196](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509195502196.png)

![image-20220509195954666](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509195954666.png)

以太网在MAC的技术

采用   CSMA/CD  技术   ：  

![image-20220509201102290](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509201102290.png)

## 数据交换方式

常见的数据交换方式：

1    直接转发：效率高， 如果不稳定网络，浪费带宽

2    存储转发：可靠，对中间设备要求较高。

3    碎片过滤：只检查64字节数据，如果正确则转发，如果错误则丢弃

![image-20220509201837988](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220509201837988.png)

## 交换机的工作原理

数据链路层的常见设备是   网桥   ，交换机switch是一个多口网桥，交换机根据数据帧的目的地址进行转发，转发的依据是 交换机内部的  端口-mac地址映射表【根据数据帧的源地址自动学习】（生存周期一般300S），如果不存在条目信息，则向所有除入口之外的端口   广播 【全1的地址】。

![image-20220516182256377](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516182256377.png)

## VLAN

容易出现伪造mac地址的攻击，数据链路层可以使用VLAN技术实现安全防护

虚拟局域网： 在一个物理局域网基于 安全【非授权访问】要求， 通信效率要求【广播泛滥】要求，将局域网划分为多个独立广播域的逻辑局域网。

核心实现： 在标准帧上添加标记，如果标记对应则能够通信，否则拒绝转发

![image-20220516183452263](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516183452263.png)

vlan标记在帧进入交换机端口的时候添加，在离开交换机端口时拆除

常见的vlan标记方式有两种：

![image-20220516184803823](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516184803823.png)

## 交换机如何管理VLAN

如何决定添加不同的vlan Tag   ,   通常存在3类方式

1    静态VLAN--基于端口的vlan【小型】

​    在交换机配置不同的端口属于不同的vlan

​    优势：简单，安全     缺陷：  灵活性不足， 

2    动态VLAN【大型】

​    2.1    基于MAC地址VLAN，需要认证收取服务器支撑

​    2.2    基于IP广播组VLAN， 跨越路由器

## VLAN的通信方式

1    access方式，接入方式，只能访问一个vlan

2    trunk方式， 干道方式，  利用一条物理线路传输多个vlan信息

![image-20220516192017904](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516192017904.png)

注意：  vlan  1是默认vlan ，所有交换机端口默认处于vlan 1 ，不能删除

不同vlan 出于逻辑合理性要求，一般都会属于不同的网络层网段，例如   vlan 1  IP段 192.168.1.X

vlan 50  属于  192.168.50.X   ，vlan 70  属于  192.168.70.X .....,

不同vlan之间的通信本质上就是网络层通信，通过路由器实现路由通信

vlan的目的是分割  冲突域和广播域【交换机分割冲突域】。

数据链路层高端技术：    VTP   协议 【修剪vlan树】   ， STP  ，都是建立在  优先级 之上。

数据链路层技术：   ATM，x.25  PPP,PPPOE,   L2TP      

# 网络层

功能：   路径选择---路由

协议结构：![image-20220516194333299](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516194333299.png)

核心协议：ip  ，  internet   protocol，  主要解决

1    协议包格式（IPV4变长格式，IPV6定长格式）

![image-20220516194954028](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516194954028.png)

![image-20220516200329290](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220516200329290.png)

2    身份识别的问题

IPV4地址：  32位地址，   每8位通过点分割转换为 十进制（点分十进制）  

X.X.X.X     每个字节最大取值    255 ，最小 0

IP地址 =    网络ID   +   主机ID

默认情况下， 网络ID相同的两台主机可以不通过路由器直接通信， 网络ID类似于电话 的区号。

按照网络ID的长度不同， IPV4定义为5类 

|     | 网络ID                                            | 主机ID | 第一个字节   |
| --- | ----------------------------------------------- | ---- | ------- |
| A   | 【**0**0000000 - **0**1111111】                   | 24位  | 0-127   |
| B   | 【**10**000000 - **10**111111】.XXXXXXXX          | 16位  | 128-191 |
| C   | 【**110**00000 - **110**11111】.XXXXXXXX.YYYYYYYY | 8位   | 192-223 |
| D   | 组播地址， 视频组播                                      |      | 224-239 |
| E   | 实验地址，ipv6 前身                                    |      | 240-255 |

 特殊的IP地址：

0.0.0.0    代表所有网络    可以作为源地址，不能作为目的地址

255.255.255.255   代表直接广播地址  ，等同于MAC FF-FF-FF-FF-FF-FF，  只能作为目的地址不能作为源地址

私有地址：  该地址只能在局域网通信，不能直接在广域网通信。

​        10.X.X.X

​        172.16.x.x  -  172.31.x.x

​        192.168.x.x

网络地址：   一个合法的网络id+全0 的主机id ， 目的是表示一个整体   ：  192.168.3.0/24

有限广播地址：一个合法的网络id+全1 的主机id ， 目的是向一个整体统一发送消息：   目的地址是 192.168.3.255， 所有的 192.168.3.0/24 网段的计算机都需要接收。

本地回环地址：   127.x.x.x  ，用作本地TCP协议通信。  常用   127.0.0.1 

169.254.x.x     微软系统自动获取IP失败后自己给自己分配的地址

地址规划，CIDR，   VLSM

IP地址是层次结构：    

10.0.0.0/8   ---->   10.1.0.0/16   --> 10.1.2.0/24 

便于组织和统编

IP = 网络ID+主机ID    模式    ，     10.0.0.0属于A类地址 ，每个网络容纳2^24个主机， 形成1广播域。划分为更小更易于管理的网段。

![image-20220523181533204](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523181533204.png)

以  192.168.1.0/24为例，能够改变的是主机id位置

![image-20220523182654342](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523182654342.png)

![image-20220523183250000](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523183250000.png)

3    通信可靠性

IP是不可靠【校验码可选】的尽最大努力【TTL】的投递业务，可靠性应该由高层解决

## IPV6：

IPV4地址耗尽， 不安全，没有QOS

IPV6：扩大了地址容量【128位】，固定首部【40字节】，流标签和优先级，首部校验和

IPV4迁移到IPV6：  双栈，GRE【承载技术】

IPV6地址： 

# 

# 路由

ip数据包在网络上传播依靠路由器转发通信

路由器工作于网络层，根据目的IP地址转发，依据   路由表   ，路由表有匹配优先原则 【掩码越长越优先】

![image-20220523190857046](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523190857046.png)

路由表是如何生成的？

1    手工静态

​    1.1    给接口配置ip参数，生成，   直连路由 C   ，   成本cost   为  0，优先级高

​    1.2    静态路由，手工配置   ，    静态路由   S   ，  成本    为    1，  优先级稍低

2    动态

​    2.1    距离矢量DV    

![image-20220523194029348](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523194029348.png)

​    2.2    链路状态LS

![image-20220523195447107](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523195447107.png)

结合自治系统AS，结合常用的具体路由协议RIP  BGP    EGP    

ICMP协议： 哨兵协议，探测，   ping测试双向连通性，发送的就是ICMP包，   路由转发和重定向发送ICMP

ARP：   地址解析协议    IP转换为 MAC

RARP： 反向地址解析协议，   MAC转换为IP   【无盘PIX系统】

![image-20220523200837293](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523200837293.png)

​    

# 传输层

端到端的通信

应用到应用，  QQ到QQ通信， web浏览器到web服务器通信

端口分用概念： 使用端口区分不同的服务需求     ，    netstat -an   

通信模式：

![image-20220523201802174](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220523201802174.png)

传输层主要有两个协议：

UDP：用户数据报协议，不可靠，非面向连接，效率高，实时性高。

TCP：传输控制协议，   可靠 ，面向连接，全双工的数据流。

![image-20220530182247693](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220530182247693.png)

![image-20220530184130942](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220530184130942.png)

TCP的握手

![image-20220530185202882](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220530185202882.png)

TCP拥塞控制

1    重传计时器管理

2    慢启动【滑动窗口的应用】

# 应用层

提供用户的接口

工作模式：C/S   client客户端/Server服务器模式，   B/S模式的本质Browser使用了通过的客户端

![image-20220530193802638](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220530193802638.png)

![image-20220530201638182](%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20220530201638182.png)
